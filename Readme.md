# Hexos



## 简介

基于[hexo](https://hexo.io/zh-cn/)的整合框架 



## 组件

### 插件

 * 文章摘录 : [hexo-excerpt](https://github.com/chekun/hexo-excerpt)  Ver:  [1.1.6](https://www.npmjs.com/package/hexo-excerpt)
 * Git部署 : [hexo-deployer-git](https://github.com/hexojs/hexo-deployer-git)  Ver:  [2.1.0](https://www.npmjs.com/package/hexo-deployer-git)
 * Feed : [hexo-generator-feed](https://github.com/hexojs/hexo-generator-feed)  Ver:  [3.0.0](https://www.npmjs.com/package/hexo-generator-feed) 
 * 搜索数据生成 : [hexo-generator-search](https://github.com/wzpan/hexo-generator-search)  Ver:  [2.4.1](https://www.npmjs.com/package/hexo-generator-search)
 * 搜索数据生成 : [hexo-generator-searchdb](https://github.com/theme-next/hexo-generator-searchdb)  Ver:  [1.3.3](https://www.npmjs.com/package/hexo-generator-searchdb)
 * 站点地图 : [hexo-generator-sitemap](https://github.com/hexojs/hexo-generator-sitemap)  Ver:  [2.1.0](https://www.npmjs.com/package/hexo-generator-sitemap)
 * JSON内容数据 : [hexo-generator-json-content](https://github.com/alexbruno/hexo-generator-json-content)  Ver:  [4.2.3](https://www.npmjs.com/package/hexo-generator-json-content)
 * Restful API : [hexo-generator-restful](https://github.com/yscoder/hexo-generator-restful)  Ver:  [0.2.3](https://www.npmjs.com/package/hexo-generator-restful)
    * PullRequests 进行中，补丁存在。
 * 外部链接nofollow : [hexo-filter-nofollow](https://github.com/hexojs/hexo-filter-nofollow)  Ver:   [2.0.2](https://www.npmjs.com/package/hexo-filter-nofollow) 
 * 字符统计和阅读时间 : [hexo-symbols-count-time](https://github.com/theme-next/hexo-symbols-count-time)  Ver:  [0.7.1](https://www.npmjs.com/package/hexo-symbols-count-time)
 * Hexo的管理界面 : [hexo-admin](https://github.com/jaredly/hexo-admin)  Ver:  [2.3.0](https://www.npmjs.com/package/hexo-admin)
 * 自动生成类别 : [hexo-auto-category](https://github.com/xu-song/hexo-auto-category)  Ver:  [0.2.0](https://www.npmjs.com/package/hexo-auto-category)
 * 唯一链接 : [hexo-abbrlink](https://github.com/rozbo/hexo-abbrlink)  Ver:  [2.2.1](https://www.npmjs.com/package/hexo-abbrlink)
 * 视频 : [hexo-tag-owl](https://github.com/m80126colin/hexo-tag-owl)  Ver:  [1.2.2](https://www.npmjs.com/package/hexo-tag-owl)
 * 博文置顶 : [hexo-generator-topindex](https://github.com/amlove2/hexo-generator-topindex)  Ver:  [0.3.0](https://www.npmjs.com/package/hexo-generator-topindex)
 * 代码演示 : [hexo-tag-demo](https://github.com/laomao800/hexo-tag-demo)  Ver:  [0.2.10](https://www.npmjs.com/package/hexo-tag-demo)
 * **内容块**  : [hexo-admonition](https://github.com/lxl80/hexo-admonition)  Ver:  [1.1.2](https://www.npmjs.com/package/hexo-admonition)
    * 已集成在内。
 * 信息卡片 : [hexo-valkyr-url](https://github.com/toastsgithub/hexo-valkyr-url)  Ver:  [1.1.0](https://www.npmjs.com/package/hexo-valkyr-url)
 * Github信息卡片 : [hexo-github-card](https://github.com/Gisonrg/hexo-github-card)  Ver:  [1.0.5](https://www.npmjs.com/package/hexo-github-card)
    * PullRequests 进行中，补丁存在。
 * bilibili页面 : [hexo-bilibili-bangumi](https://github.com/HCLonely/hexo-bilibili-bangumi)  Ver:  [1.5.1](https://www.npmjs.com/package/hexo-bilibili-bangumi)
 * 工具提示 : [hexo-reference](https://github.com/kchen0x/hexo-reference)  Ver:  [1.0.4](https://www.npmjs.com/package/hexo-reference)
 * 流程图flowchart : [hexo-filter-flowchart](https://github.com/bubkoo/hexo-filter-flowchart)  Ver:  [1.0.4](https://www.npmjs.com/package/hexo-filter-flowchart)
 * UML图sequence : [hexo-filter-sequence](https://github.com/bubkoo/hexo-filter-sequence)  Ver:  [1.0.3](https://www.npmjs.com/package/hexo-filter-sequence)
 * 渲染引擎 : [hexo-renderer-markdown-it](https://github.com/hexojs/hexo-renderer-markdown-it)  Ver:   [5.0.0](https://www.npmjs.com/package/hexo-renderer-markdown-it) 
    * PullRequests 未通过，补丁存在。
 * 懒加载图像 : [hexo-lazyload-image](https://github.com/Troy-Yang/hexo-lazyload-image)  Ver:  [1.0.9](https://www.npmjs.com/package/hexo-lazyload-image)
 * 优化HTML，CSS，JS和images : [hexo-all-minifier](https://github.com/chenzhutian/hexo-all-minifier)  Ver:  [0.5.5](https://www.npmjs.com/package/hexo-all-minifier)
 * 推送新链接至搜索引擎 : [hexo-submit-urls-to-search-engine](https://github.com/cjh0613/hexo-submit-urls-to-search-engine)  Ver:   [2.0.0](https://www.npmjs.com/package/hexo-submit-urls-to-search-engine) 
 * 二维码生成 : [hexo-tag-qrcode](https://github.com/jsweibo/hexo-tag-qrcode)  Ver:  [1.0.0](https://www.npmjs.com/package/hexo-tag-qrcode)
 * 音频 : [hexo-tag-aplayer](https://github.com/MoePlayer/hexo-tag-aplayer)  Ver:  [3.0.4](https://www.npmjs.com/package/hexo-tag-aplayer)
 * 相关帖子和热门帖子 : [hexo-related-popular-posts](https://github.com/tea3/hexo-related-popular-posts)  Ver:  [5.0.1](https://www.npmjs.com/package/hexo-related-popular-posts)




### 主题

* NexT： [theme-next/hexo-theme-next](https://github.com/theme-next/hexo-theme-next)    v7.8.0 :  [`f995680`](https://github.com/theme-next/hexo-theme-next/commit/f9956802c9cf51ebdb447fb954efa6383fbb2bd6) 



## 使用

### 下载

```shell
git clone --depth 1 https://github.com/StaticSiteTools/Hexos  Hexos
```



### 安装

```
./Start  install
```



### 补丁

```
./Start  patch
```



### 初始化

```
./Start  init  [Lang]  [Theme] [Author]
```

`[Lang]` :  语言(en|cn<默认>)

`[Theme]` :  主题(next<默认>|) 

`[Author]` :  作者

> 注意： 初始化，只需执行一次即可。



### 在线集成

使用的在线集成服务有：

* [Travis CI](https://travis-ci.com/)
* [Github Actions](https://docs.github.com/en/free-pro-team@latest/actions)

#### Travis CI

需要在 Travis CI 的web页面中配置如下环境变量：

* `HEXOS_GITHUB_TOKEN`:  Github 令牌。

* `HEXOS_GITEE_USER`:  Gitee 用户。

  * 个人空间地址后缀，如`https://gitee.com/XXX` 中的 `XXX`。

* `HEXOS_GITEE_TOKEN`:  Gitee 令牌。

* `HEXOS_CODING_PROJECT_USER`:  Coding项目用户。

* `HEXOS_CODING_PROJECT_TOKEN`:  Coding项目令牌。

* `HEXOS_U_NAME`:  提交者名称。

* `HEXOS_U_EMAIL`:  提交者邮件地址。

* `HEXOS_GITHUB_REF`:  仓库地址，[Github](https://github.com/)。无`https`。

* `HEXOS_GITHUB_BRANCH`:  远端分支，[Github](https://github.com/)。

* `HEXOS_GITEE_REF`:  仓库地址，[Gitee](https://gitee.com/)。无`https`。

* `HEXOS_GITEE_BRANCH`: 远端分支，[Gitee](https://gitee.com/)。

* `HEXOS_CODING_REF`:  仓库地址，[Coding](https://coding.net/)。无`https`。

* `HEXOS_CODING_BRANCH`: 远端分支，[Coding](https://coding.net/)。

* `HEXOS_NOTICE_EMAIL`:  接收通知的邮件地址。必需。

* `TZ`:  时区。参阅  [时区列表](https://www.php.net/manual/zh/timezones.php)。**必需**。

* ~~`HEXOS_WATCH_BRANCH` :  监控项目源中的分支。必需。~~

  * 经过实践，`branches`节点下好像不能使用变量。请直接在 `.travis.yml` 中修改。

    ```yaml
    branches:
      only:
        - master
    ```

    

默认情况下，只启用了Github平台，要推送到其它代码托管平台，需要在 `.travis.yml` 中修改，去掉前面的`#`

```yaml
  #------------START: 推送至远端仓库 ------------#  
  # Github 
  - git push --force --quiet "https://${HEXOS_GITHUB_TOKEN}@${HEXOS_GITHUB_REF}" master:${HEXOS_GITHUB_BRANCH}
  
  # Gitee
  - git push --force --quiet "https://${HEXOS_GITEE_USER}:${HEXOS_GITEE_TOKEN}@${HEXOS_GITEE_REF}" master:${HEXOS_GITEE_BRANCH}
  
  # Coding
  - git push --force --quiet "https://${HEXOS_CODING_PROJECT_USER}:${HEXOS_CODING_PROJECT_TOKEN}@${HEXOS_CODING_REF}" master:${HEXOS_CODING_BRANCH} 
  #-------------END: 推送至远端仓库 -------------#
```



#### Github Actions

需要在`.github/workflows/GitHubActions.yml`文件中配置如下环境变量：

* `TZ`:  时区。参阅  [时区列表](https://www.php.net/manual/zh/timezones.php)。**必需**。
* `HEXOS_U_NAME`:  提交者名称。
* `HEXOS_U_EMAIL`:  提交者邮件地址。
* `HEXOS_GITHUB_REF`:  仓库地址，[Github](https://github.com/)。无`https`。
* `HEXOS_GITHUB_BRANCH`:  远端分支，[Github](https://github.com/)。
* `HEXOS_GITEE_REF`:  仓库地址，[Gitee](https://gitee.com/)。无`https`。
* `HEXOS_GITEE_BRANCH`: 远端分支，[Gitee](https://gitee.com/)。
* `HEXOS_CODING_REF`:  仓库地址，[Coding](https://coding.net/)。无`https`。
* `HEXOS_CODING_BRANCH`: 远端分支，[Coding](https://coding.net/)。

> 注意： 推荐在Github的仓库中配置这些环境变量。



在Github的仓库中配置这些环境变量:

* `HEXOS_GITHUB_TOKEN`:  Github 令牌。
* `HEXOS_GITEE_USER`:  Gitee 用户。
  * 个人空间地址后缀，如`https://gitee.com/XXX` 中的 `XXX`。
* `HEXOS_GITEE_TOKEN`:  Gitee 令牌。
* `HEXOS_CODING_PROJECT_USER`:  Coding项目用户。
* `HEXOS_CODING_PROJECT_TOKEN`:  Coding项目令牌。



默认情况下，只启用了Github平台，要推送到其它代码托管平台，需要在`.github/workflows/GitHubActions.yml`文件修改，去掉前面的`#`

```yaml
      # 将编译后的文件推送到指定仓库
    - name: 部署Hexos到GITHUB
      continue-on-error: true
      run: |  
        cd ./public
        git push --force --quiet "https://${{ secrets.HEXOS_GITHUB_TOKEN }}@${HEXOS_GITHUB_REF}" master:${HEXOS_GITHUB_BRANCH}
    - name: 部署Hexos到CODING
      continue-on-error: true
      run: |  
        cd ./public
        git push --force --quiet "https://${{ secrets.HEXOS_CODING_PROJECT_USER }}:${{ secrets.HEXOS_CODING_PROJECT_TOKEN }}@${HEXOS_CODING_REF}" master:${HEXOS_CODING_BRANCH}  
    - name: 部署Hexos到GITEE
      continue-on-error: true
      run: |  
#         rm -rf public/.git
#         rm -f public/.gitattributes
#         git init public/
#         git config -f public/.git/config  user.name "${HEXOS_U_NAME}"
#         git config -f public/.git/config  user.email "${HEXOS_U_EMAIL}"
#         git config -f public/.git/config  http.postBuffer  524288000
#         ( cd ./public && git add . && git commit -m "GitHub Actions 自动构建在 `date +"%Y-%m-%d %H:%M"`" )
        cd ./public
        git push --force --quiet "https://${{ secrets.HEXOS_GITEE_USER }}:${{ secrets.HEXOS_GITEE_TOKEN }}@${HEXOS_GITEE_REF}" master:${HEXOS_GITEE_BRANCH}
```

Gitee平台的LFS支持只限企业版，如果没有购买企业版的话，可启用上面注释的代码。



## 运行

> 参阅：[hexo-commands](https://hexo.io/zh-cn/docs/commands)

### 清除缓存 

```shell
hexo clean
```

清除缓存文件 (`db.json`) 和已生成的静态文件 (`public`)。 

### 生成静态文件 

```shell
hexo generate
```

### 本地预览

```shell
hexo server
```

启动本地服务器。默认情况下，访问网址为： `http://localhost:4000/`。 



### 命令组合

```shell
hexo clean &&  hexo generate &&  hexo server
```



## 语法

参阅  `doc/User/Use.cn.md`



## 令牌获取

### Github 

> 参阅：  [创建个人访问令牌](https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token) 

1. [验证您的电子邮件地址](https://docs.github.com/en/free-pro-team@latest/articles/verifying-your-email-address)（如果尚未验证）。

2. 在任何页面的右上角，点击您的个人资料头像，然后点击**设置**。

   ![用户栏中的设置图标](https://docs.github.com/assets/images/help/settings/userbar-account-settings.png)

   

3. 在左侧边栏中，点击**开发人员设置**。

   ![开发人员设定](https://docs.github.com/assets/images/help/settings/developer-settings.png)

   

4. 在左侧边栏中，点击**个人访问令牌**。

   ![个人访问令牌](https://docs.github.com/assets/images/help/settings/personal_access_tokens_tab.png)

   

5. 点击**生成新令牌**。

   ![生成新令牌按钮](https://docs.github.com/assets/images/help/settings/generate_new_token.png)

   

6. 给您的令牌一个描述性名称。

   ![令牌描述字段](https://docs.github.com/assets/images/help/settings/token_description.png)

   

7. 选择您要授予此令牌的范围或权限。要使用令牌从命令行访问存储库，请选择**repo**。

   ![选择令牌范围](https://docs.github.com/assets/images/help/settings/token_scopes.gif)

   

8. 点击**生成令牌**。

   ![生成令牌按钮](https://docs.github.com/assets/images/help/settings/generate_token.png)

   

9. 单击图标以将令牌复制到剪贴板。出于安全原因，在您离开页面后，您将无法再次看到该令牌。

   ![新创建的令牌](https://docs.github.com/assets/images/help/settings/personal_access_tokens.png)

   

   > **警告：**将您的令牌视为密码，并将其保密。使用API时，请将标记用作环境变量，而不是将其硬编码到程序中。



### Gitee 

> 参阅：  [创建个人访问令牌](https://gitee.com/profile/personal_access_tokens) 


1. 登录你的帐号在[Gitee](https://gitee.com)。

2. 在任何页面的右上角，点击您的个人资料头像，然后点击**设置**。

3. 在左侧边栏中，点击**私人令牌**。

5. 点击**生成新令牌**。

6. 给您的令牌一个描述性名称。 

7. 选择您要授予此令牌的范围或权限。

8. 点击**提交**以生成令牌。敏感操作，需要密码。

9. 单击图标以将令牌复制到剪贴板。出于安全原因，在您离开页面后，您将无法再次看到该令牌。


   > **警告：**将您的令牌视为密码，并将其保密。使用API时，请将标记用作环境变量，而不是将其硬编码到程序中。



### Coding

> 参阅：
>
> [个人访问令牌](https://help.coding.net/docs/member/tokens.html)  
>
> [项目令牌](https://help.coding.net/docs/project-settings/features/deploy-tokens.html)

#### 创建个人令牌
1. 在个人头像的下拉菜单中，选择个人设置。

   ![img](https://help-assets.codehub.cn/enterprise/20191230164301.png) 


2. 在左栏中选择访问令牌即可进入个人访问令牌列表，点击新建令牌。
   ![img](https://help-assets.codehub.cn/enterprise/20191230163637.png) 


3. 在表单中填写令牌描述，以及选择此令牌的访问权限。填完后提交。
   ![img](https://help-assets.codehub.cn/enterprise/20190924204359.png) 


提交后，页面会跳回访问令牌列表页面，并将新建的令牌的内容显示出来。

> 注意：令牌的内容只会显示一次，为了安全，请将其复制粘贴至您需要使用的地方，并不要保存副本。 如果您是需要调试，请在调试后，选择重新生成令牌，再将其粘贴到最终使用程序或的脚本中。



#### 创建项目令牌

1. 在项目中点击【项目设置】->【开发者选项】->【项目令牌】->【 新增项目令牌】。

![img](https://help-assets.codehub.cn/enterprise/20191230150105.png)

2. 输入令牌名称、选择过期时间、勾选令牌权限后即可完成创建。

![img](https://help-assets.codehub.cn/enterprise/20191230150155.png)



